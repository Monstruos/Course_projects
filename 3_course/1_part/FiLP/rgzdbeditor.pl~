:-dynamic plane/5.

run():-
     retractall(plane/5),
     consult('RGZdatabase.pl'),
     menu().

menu():-
      repeat,
      write('-----------------------'),nl,nl,
      write('База данных с расписанием движения самолетов'),nl,nl,
      write('1–Просмотр базы'),nl,
      write('2–Добавить новый рейс'),nl,
      write('3-Удалить рейс (по номеру)'),nl,
      write('4-Поиск всех рейсов до города, вылетающих в ближайшие 6 часов с минимальной стоимостью билета'),nl,
      write('5–Выход (и сохранение)'),nl,
      write('--------------------------------'),nl,
      write('Выберите пункт меню: (1-6) '),
      read(X),
      X>0,
      X<6,
      %process(X),
      X=:=5,!.

process(1):-dbview().
%process(2):-add_iron,!.
%process(3):-remove_iron,!.
%process(4):-db_save_iron,!.
%process(5):-find_iron,!.
%process(6):-retractall(iron/3),!.

dbview():-
    write('Просмотр:'), nl,
    plane(Flight, City, time(Hour, Min), date(Day, Month), Cost),
    write('Рейс:'), write(Flight), nl,
    write('Город:'), write(City), nl,
    write('Время:'), write(Hour), write(':'), write(Min), nl,
    write('Дата:'), write(Day), write('-'), write(Month), nl,
    write('Стоимость:'), write(Cost), nl.

add():-
    write('Добавить рейс:'), nl,
    repeat,
    write('Номер рейса: '),
    read(Flight),
    write('Город: '),
    read(City),
    write('Время (час): '),
    read(Hour),
    write('Время (минута): '),
    read(Min),
    write('Дата (день): '),
    read(Day),
    write('Дата (месяц): '),
    read(Month),
    write('Стоимость: '),
    read(Cost),
    assertz(plane(Flight, City, time(Hour, Min), date(Day, Month), Cost)),
    next(),!.

next():-
    write('Выход? (q для выхода)'),
    read(A),
    exit(A).

exit(_):-fail.
exit(q).

delete_plane():-
    write('Удаление рейса(по номеру):'), nl,
    repeat,
    write('Введите номер:'),
    read(F),
    retract(plane(F, _, _, _, _)),
    next(),!.


find():-
    write('Введите время (час)'),
    read(T1),
    write('Введите время (минута)'),
    read(T2),
    write('Введите дату (день)'),
    read(D1),
    write('Введите дату (месяц)'),
    read(D2),
    list(time(T1, T2), date(D1, D2), L),
    L = [0].

list(time(H, M), date(D, Mon), L):-
    plane(F, City, time(H1, M1), date(D1, Mon1), Cost),
    compare(time(H, M), date(D, Mon), time(H1, M1), date(D1, Mon1), Res),
    Res >= 0,
    Res =< 360,
    write('Рейс:'), write(F), nl,
    write('Город:'), write(City), nl,
    write('Время:'), write(H1), write(':'), write(M1), nl,
    write('Дата:'), write(D1), write('-'), write(Mon1), nl,
    write('Стоимость:'), write(Cost), nl,
    append(plane(F, City, time(H1, M1), date(D1, Mon1), Cost), L, L).


compare(time(H1, M1), date(D1, M1), time(H2, M2), date(D2, M2), Rest):-
    compd(date(D1, M1), date(D2, M2), Resd),
    handler(Resd, time(H1, M1), time(H2, M2), Rest).

handler(0, time(H1, M1), time(H2, M2), Rest):-
    compt(time(H1, M1), time(H2, M2), Rest).
handler(1, time(H1, M1), time(H2, M2), Rest):-
    Hb is H2 + 24,
    compt(time(H1, M1), time(Hb, M2), Rest).

compt(time(H1, M1), time(H2, M2), R):-
    R is (H2-H1)*60 + (M2-M1).

compd(date(31, 1), date(1, 2), 1).
compd(date(28, 2), date(1, 3), 1).
compd(date(31, 3), date(1, 4), 1).
compd(date(30, 4), date(1, 5), 1).
compd(date(31, 5), date(1, 6), 1).
compd(date(30, 6), date(1, 7), 1).
compd(date(31, 7), date(1, 8), 1).
compd(date(31, 8), date(1, 9), 1).
compd(date(30, 9), date(1, 10), 1).
compd(date(31, 10), date(1, 11), 1).
compd(date(30, 11), date(1, 12), 1).
compd(date(31, 12), date(1, 1), 1).
compd(date(D1, M1), date(D2, M2), R):-
    (M1 \== M2)->
    R is -1;
    R is D2 - D1.

